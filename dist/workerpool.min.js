!function(r,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("os"),function(){try{return require("worker_threads")}catch(r){}}(),require("child_process")):"function"==typeof define&&define.amd?define(["os","worker_threads","child_process"],e):"object"==typeof exports?exports.workerpool=e(require("os"),function(){try{return require("worker_threads")}catch(r){}}(),require("child_process")):r.workerpool=e(r.os,r.worker_threads,r.child_process)}(this,function(__WEBPACK_EXTERNAL_MODULE_2__,__WEBPACK_EXTERNAL_MODULE_12__,__WEBPACK_EXTERNAL_MODULE_13__){return i=[function(r,e,t){var o=t(1);e.pool=function(r,e){return new(t(3))(r,e)},e.worker=function(r){var e=t(11);e.add(r)},e.Promise=t(4),e.platform=o.platform,e.isMainThread=o.isMainThread,e.cpus=o.cpus},function(r,e,t){r.exports.platform="undefined"!=typeof Window||"undefined"!=typeof WorkerGlobalScope?"browser":"node",r.exports.isMainThread="browser"===r.exports.platform?"undefined"!=typeof Window:!process.connected,r.exports.cpus="browser"===r.exports.platform?self.navigator.hardwareConcurrency:t(2).cpus().length},function(r,e){r.exports=require("os")},function(r,e,t){var i=t(4),o=t(5),n=t(1),s=new(t(8));function a(r,e){"string"==typeof r?this.script=r||null:(this.script=null,e=r),this.workers=[],this.tasks=[],e=e||{},this.forkArgs=e.forkArgs||[],this.forkOpts=e.forkOpts||{},this.debugPortStart=e.debugPortStart||43210,this.nodeWorker=e.nodeWorker,e&&"maxWorkers"in e?(function(r){if(!u(r)||!c(r)||r<1)throw new TypeError("Option maxWorkers must be an integer number >= 1")}(e.maxWorkers),this.maxWorkers=e.maxWorkers):this.maxWorkers=Math.max((n.cpus||4)-1,1),e&&"minWorkers"in e&&("max"===e.minWorkers?this.minWorkers=Math.max((n.cpus||4)-1,1):(function(r){if(!u(r)||!c(r)||r<0)throw new TypeError("Option minWorkers must be an integer number >= 0")}(e.minWorkers),this.minWorkers=e.minWorkers,this.maxWorkers=Math.max(this.minWorkers,this.maxWorkers)),this._ensureMinWorkers()),this._boundNext=this._next.bind(this),"thread"===this.nodeWorker&&o.ensureWorkerThreads()}function u(r){return"number"==typeof r}function c(r){return Math.round(r)==r}a.prototype.exec=function(r,e){if(e&&!Array.isArray(e))throw new TypeError('Array expected as argument "params"');if("string"==typeof r){var t=i.defer(),o=this.tasks,n={method:r,params:e,resolver:t,timeout:null};o.push(n);var s=t.promise.timeout;return t.promise.timeout=function(r){return-1!==o.indexOf(n)?(n.timeout=r,t.promise):s.call(t.promise,r)},this._next(),t.promise}if("function"==typeof r)return this.exec("run",[String(r),e]);throw new TypeError('Function or string expected as argument "method"')},a.prototype.proxy=function(){if(0<arguments.length)throw new Error("No arguments expected");var t=this;return this.exec("methods").then(function(r){var e={};return r.forEach(function(r){e[r]=function(){return t.exec(r,Array.prototype.slice.call(arguments))}}),e})},a.prototype._next=function(){if(0<this.tasks.length){var r=this._getWorker();if(r){var e=this,t=this.tasks.shift();if(t.resolver.promise.pending){var o=r.exec(t.method,t.params,t.resolver).then(e._boundNext).catch(function(){r.terminated&&(e._removeWorker(r),e._ensureMinWorkers()),e._next()});"number"==typeof t.timeout&&o.timeout(t.timeout)}else e._next()}}},a.prototype._getWorker=function(){for(var r=this.workers,e=0;e<r.length;e++){var t=r[e];if(!1===t.busy())return t}return r.length<this.maxWorkers?(t=new o(this.script,{forkArgs:this.forkArgs,forkOpts:this.forkOpts,debugPort:s.nextAvailableStartingAt(this.debugPortStart),nodeWorker:this.nodeWorker}),r.push(t),t):null},a.prototype._removeWorker=function(r){s.releasePort(r.debugPort),r.terminate(),this._removeWorkerFromList(r)},a.prototype._removeWorkerFromList=function(r){var e=this.workers.indexOf(r);-1!=e&&this.workers.splice(e,1)},a.prototype.terminate=function(t,o){var n=function(r){this._removeWorkerFromList(r)}.bind(this),s=[];return this.workers.slice().forEach(function(r){var e=r.terminateAndNotify(t,o).then(n);s.push(e)}),i.all(s)},a.prototype.clear=function(r){this.terminate(r)},a.prototype.stats=function(){var r=this.workers.length,e=this.workers.filter(function(r){return r.busy()}).length;return{totalWorkers:r,busyWorkers:e,idleWorkers:r-e,pendingTasks:this.tasks.length,activeTasks:e}},a.prototype._ensureMinWorkers=function(){if(this.minWorkers)for(var r=this.workers.length;r<this.minWorkers;r++)this.workers.push(new o(this.script,{forkArgs:this.forkArgs,forkOpts:this.forkOpts,debugPort:s.nextAvailableStartingAt(this.debugPortStart)}))},r.exports=a},function(r,e){"use strict";function u(r,t){var o=this;if(!(this instanceof u))throw new SyntaxError("Constructor must be called with the new operator");if("function"!=typeof r)throw new SyntaxError("Function parameter handler(resolve, reject) missing");var n=[],s=[];this.resolved=!1,this.rejected=!1,this.pending=!0;var i=function(r,e){n.push(r),s.push(e)};this.then=function(n,s){return new u(function(r,e){var t=n?c(n,r,e):r,o=s?c(s,r,e):e;i(t,o)},o)};var e=function(t){return o.resolved=!0,o.rejected=!1,o.pending=!1,n.forEach(function(r){r(t)}),i=function(r,e){r(t)},e=a=function(){},o},a=function(t){return o.resolved=!1,o.rejected=!0,o.pending=!1,s.forEach(function(r){r(t)}),i=function(r,e){e(t)},e=a=function(){},o};this.cancel=function(){return t?t.cancel():a(new f),o},this.timeout=function(r){if(t)t.timeout(r);else{var e=setTimeout(function(){a(new p("Promise timed out after "+r+" ms"))},r);o.always(function(){clearTimeout(e)})}return o},r(function(r){e(r)},function(r){a(r)})}function c(t,o,n){return function(r){try{var e=t(r);e&&"function"==typeof e.then&&"function"==typeof e.catch?e.then(o,n):o(e)}catch(r){n(r)}}}function f(r){this.message=r||"promise cancelled",this.stack=(new Error).stack}function p(r){this.message=r||"timeout exceeded",this.stack=(new Error).stack}u.prototype.catch=function(r){return this.then(null,r)},u.prototype.always=function(r){return this.then(r,r)},u.all=function(r){return new u(function(t,o){var n=r.length,s=[];n?r.forEach(function(r,e){r.then(function(r){s[e]=r,0==--n&&t(s)},function(r){n=0,o(r)})}):t(s)})},u.defer=function(){var t={};return t.promise=new u(function(r,e){t.resolve=r,t.reject=e}),t},(f.prototype=new Error).constructor=Error,f.prototype.name="CancellationError",u.CancellationError=f,(p.prototype=new Error).constructor=Error,p.prototype.name="TimeoutError",u.TimeoutError=p,r.exports=u},function(r,e,a){"use strict";var i=a(4),s=a(6),u=a(1);function c(){var r=f("worker_threads");if(!r)throw new Error("WorkerPool: nodeWorkers = thread is not supported, Node >= 11.7.0 required");return r}function f(r){try{return a(7)(r)}catch(r){if("object"==typeof r&&null!==r&&"MODULE_NOT_FOUND"==r.code)return null;throw r}}function p(r,e){var t=new e(r);return t.isBrowserWorker=!0,t.on=function(r,e){this.addEventListener(r,function(r){e(r.data)})},t.send=function(r){this.postMessage(r)},t}function d(r,e){var t=new e.Worker(r,{stdout:!1,stderr:!1});return t.isWorkerThread=!0,t.send=function(r){this.postMessage(r)},t.kill=function(){this.terminate()},t.disconnect=function(){this.terminate()},t}function h(r,e,t){var o=t.fork(r,e.forkArgs,e.forkOpts);return o.isChildProcess=!0,o}function l(r){r=r||{};var e=process.execArgv.join(" "),t=-1!==e.indexOf("--inspect"),o=-1!==e.indexOf("--debug-brk"),n=[];return t&&(n.push("--inspect="+r.debugPort),o&&n.push("--debug-brk")),s({},r,{forkArgs:r.forkArgs,forkOpts:s({},r.forkOpts,{execArgv:(r.forkOpts&&r.forkOpts.execArgv||[]).concat(n)})})}function t(r,e){this.script=r||function(){if("browser"!=u.platform)return __dirname+"/worker.js";if("undefined"==typeof Blob)throw new Error("Blob not supported by the browser");if(!window.URL||"function"!=typeof window.URL.createObjectURL)throw new Error("URL.createObjectURL not supported by the browser");var r=new Blob([a(9)],{type:"text/javascript"});return window.URL.createObjectURL(r)}();var t=e||{};if(this.debugPort=t.debugPort,"browser"==u.platform){if("function"!=typeof Worker&&("object"!=typeof Worker||"function"!=typeof Worker.prototype.constructor))throw new Error("WorkerPool: Web workers not supported by the browser");this.worker=p(this.script,Worker)}else{var o;"thread"===t.nodeWorker?(o=c(),this.worker=d(this.script,o)):"auto"===t.nodeWorker?(o=f("worker_threads"),this.worker=o?d(this.script,o):h(this.script,l(t),a(13))):this.worker=h(this.script,l(t),a(13))}var n=this;function s(r){for(var e in n.terminated=!0,n.terminating&&n.terminationHandler&&n.terminationHandler(n),n.terminating=!1,n.processing)void 0!==n.processing[e]&&n.processing[e].resolver.reject(r);n.processing=Object.create(null)}r||(this.worker.ready=!0),this.requestQueue=[],this.worker.on("message",function(r){if("string"==typeof r&&"ready"===r)n.worker.ready=!0,n.requestQueue.forEach(n.worker.send.bind(n.worker)),n.requestQueue=[];else{var e=r.id,t=n.processing[e];void 0!==t&&(delete n.processing[e],!0===n.terminating&&n.terminate(),r.error?t.resolver.reject(function(r){for(var e=new Error(""),t=Object.keys(r),o=0;o<t.length;o++)e[t[o]]=r[t[o]];return e}(r.error)):t.resolver.resolve(r.result))}});var i=this.worker;this.worker.on("error",s),this.worker.on("exit",function(r,e){var t="Workerpool Worker terminated Unexpectedly\n";t+="    exitCode: `"+r+"`\n",t+="    signalCode: `"+e+"`\n",t+="    workerpool.script: `"+n.script+"`\n",t+="    spawnArgs: `"+i.spawnargs+"`\n",t+="    spawnfile: `"+i.spawnfile+"`\n",t+="    stdout: `"+i.stdout+"`\n",t+="    stderr: `"+i.stderr+"`\n",s(new Error(t))}),this.processing=Object.create(null),this.terminating=!1,this.terminated=!1,this.terminationHandler=null,this.lastId=0}t.prototype.methods=function(){return this.exec("methods")},t.prototype.exec=function(r,e,t){t=t||i.defer();var o=++this.lastId;this.processing[o]={id:o,resolver:t};var n={id:o,method:r,params:e};this.terminated?t.reject(new Error("Worker is terminated")):this.worker.ready?this.worker.send(n):this.requestQueue.push(n);var s=this;return t.promise.catch(function(r){if(!(r instanceof i.CancellationError||r instanceof i.TimeoutError))throw r;delete s.processing[o],s.terminate(!0)}),t.promise},t.prototype.busy=function(){return 0<Object.keys(this.processing).length},t.prototype.terminate=function(r,e){if(r){for(var t in this.processing)void 0!==this.processing[t]&&this.processing[t].resolver.reject(new Error("Worker terminated"));this.processing=Object.create(null)}if("function"==typeof e&&(this.terminationHandler=e),this.busy())this.terminating=!0;else{if(this.worker){if("function"==typeof this.worker.kill)this.worker.kill();else{if("function"!=typeof this.worker.terminate)throw new Error("Failed to terminate worker");this.worker.terminate()}this.worker=null}this.terminating=!1,this.terminated=!0,this.terminationHandler&&this.terminationHandler(this)}},t.prototype.terminateAndNotify=function(r,e){var t=i.defer();return e&&(t.promise.timeout=e),this.terminate(r,function(r){t.resolve(r)}),t.promise},r.exports=t,r.exports._tryRequire=f,r.exports._setupProcessWorker=h,r.exports._setupBrowserWorker=p,r.exports._setupWorkerThreadWorker=d,r.exports.ensureWorkerThreads=c},function(r,e){"use strict";var u=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable;r.exports=function(){try{if(!Object.assign)return!1;var r=new String("abc");if(r[5]="de","5"===Object.getOwnPropertyNames(r)[0])return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(r){return e[r]}).join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach(function(r){o[r]=r}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(r){return!1}}()?Object.assign:function(r,e){for(var t,o,n=function(r){if(null==r)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(r)}(r),s=1;s<arguments.length;s++){for(var i in t=Object(arguments[s]))c.call(t,i)&&(n[i]=t[i]);if(u){o=u(t);for(var a=0;a<o.length;a++)f.call(t,o[a])&&(n[o[a]]=t[o[a]])}}return n}},function(r,e,t){var o={"./Pool":3,"./Pool.js":3,"./Promise":4,"./Promise.js":4,"./WorkerHandler":5,"./WorkerHandler.js":5,"./debug-port-allocator":8,"./debug-port-allocator.js":8,"./environment":1,"./environment.js":1,"./generated/embeddedWorker":9,"./generated/embeddedWorker.js":9,"./header":10,"./header.js":10,"./worker":11,"./worker.js":11};function n(r){return t(s(r))}function s(r){return o[r]||function(){throw new Error("Cannot find module '"+r+"'.")}()}n.keys=function(){return Object.keys(o)},n.resolve=s,(r.exports=n).id=7},function(r,e){"use strict";function t(){this.ports=Object.create(null),this.length=0}(r.exports=t).prototype.nextAvailableStartingAt=function(r){for(;!0===this.ports[r];)r++;if(65535<=r)throw new Error("WorkerPool debug port limit reached: "+r+">= 65535");return this.ports[r]=!0,this.length++,r},t.prototype.releasePort=function(r){delete this.ports[r],this.length--}},function(r,e){r.exports='!function(o){var n={};function t(r){if(n[r])return n[r].exports;var e=n[r]={exports:{},id:r,loaded:!1};return o[r].call(e.exports,e,e.exports,t),e.loaded=!0,e.exports}t.m=o,t.c=n,t.p="",t(0)}([function(module,exports,__webpack_require__){var worker={};if("undefined"!=typeof self&&"function"==typeof postMessage&&"function"==typeof addEventListener)worker.on=function(r,e){addEventListener(r,function(r){e(r.data)})},worker.send=function(r){postMessage(r)};else{if("undefined"==typeof process)throw new Error("Script must be executed as a worker");var WorkerThreads;try{WorkerThreads=__webpack_require__(!function(){var r=new Error(\'Cannot find module "worker_threads"\');throw r.code="MODULE_NOT_FOUND",r}())}catch(r){if("object"!=typeof r||null===r||"MODULE_NOT_FOUND"!=r.code)throw r}if(WorkerThreads&&null!==WorkerThreads.parentPort){var parentPort=WorkerThreads.parentPort;worker.send=parentPort.postMessage.bind(parentPort),worker.on=parentPort.on.bind(parentPort)}else worker.on=process.on.bind(process),worker.send=process.send.bind(process)}function convertError(o){return Object.getOwnPropertyNames(o).reduce(function(r,e){return Object.defineProperty(r,e,{value:o[e],enumerable:!0})},{})}function isPromise(r){return r&&"function"==typeof r.then&&"function"==typeof r.catch}worker.methods={},worker.methods.run=function run(fn,args){var f=eval("("+fn+")");return f.apply(f,args)},worker.methods.methods=function(){return Object.keys(worker.methods)},worker.on("message",function(e){try{var r=worker.methods[e.method];if(!r)throw new Error(\'Unknown method "\'+e.method+\'"\');var o=r.apply(r,e.params);isPromise(o)?o.then(function(r){worker.send({id:e.id,result:r,error:null})}).catch(function(r){worker.send({id:e.id,result:null,error:convertError(r)})}):worker.send({id:e.id,result:o,error:null})}catch(r){worker.send({id:e.id,result:null,error:convertError(r)})}}),worker.register=function(r){if(r)for(var e in r)r.hasOwnProperty(e)&&(worker.methods[e]=r[e]);worker.send("ready")},exports.add=worker.register}]);'},function(r,e){},function(module,exports,__webpack_require__){var worker={};if("undefined"!=typeof self&&"function"==typeof postMessage&&"function"==typeof addEventListener)worker.on=function(r,e){addEventListener(r,function(r){e(r.data)})},worker.send=function(r){postMessage(r)};else{if("undefined"==typeof process)throw new Error("Script must be executed as a worker");var WorkerThreads;try{WorkerThreads=__webpack_require__(12)}catch(r){if("object"!=typeof r||null===r||"MODULE_NOT_FOUND"!=r.code)throw r}if(WorkerThreads&&null!==WorkerThreads.parentPort){var parentPort=WorkerThreads.parentPort;worker.send=parentPort.postMessage.bind(parentPort),worker.on=parentPort.on.bind(parentPort)}else worker.on=process.on.bind(process),worker.send=process.send.bind(process)}function convertError(t){return Object.getOwnPropertyNames(t).reduce(function(r,e){return Object.defineProperty(r,e,{value:t[e],enumerable:!0})},{})}function isPromise(r){return r&&"function"==typeof r.then&&"function"==typeof r.catch}worker.methods={},worker.methods.run=function run(fn,args){var f=eval("("+fn+")");return f.apply(f,args)},worker.methods.methods=function(){return Object.keys(worker.methods)},worker.on("message",function(e){try{var r=worker.methods[e.method];if(!r)throw new Error('Unknown method "'+e.method+'"');var t=r.apply(r,e.params);isPromise(t)?t.then(function(r){worker.send({id:e.id,result:r,error:null})}).catch(function(r){worker.send({id:e.id,result:null,error:convertError(r)})}):worker.send({id:e.id,result:t,error:null})}catch(r){worker.send({id:e.id,result:null,error:convertError(r)})}}),worker.register=function(r){if(r)for(var e in r)r.hasOwnProperty(e)&&(worker.methods[e]=r[e]);worker.send("ready")},exports.add=worker.register},function(r,e){r.exports=require("worker_threads")},function(r,e){r.exports=require("child_process")}],j={},k.m=i,k.c=j,k.p="",k(0);function k(r){if(j[r])return j[r].exports;var e=j[r]={exports:{},id:r,loaded:!1};return i[r].call(e.exports,e,e.exports,k),e.loaded=!0,e.exports}var i,j});
//# sourceMappingURL=workerpool.map